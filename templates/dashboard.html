{% extends "base.html" %}
{% block title %}Dashboard | MuscleGain{% endblock %}

{% block content %}
<div class="dashboard">

  <aside class="sidebar">
    <div class="sidebar-logo">MUSCLE<span class="gain">GAIN</span></div>

    <nav class="sidebar-menu">
      <a class="active" href="{{ url_for('dashboard') }}">Inicio</a>
      <a href="{{ url_for('register_session') }}">Registro</a>
      <a href="{{ url_for('routines') }}">Rutinas</a>
      <a href="{{ url_for('progress') }}">Progreso</a>
      <a href="{{ url_for('muscle_map') }}">Músculos</a>
    </nav>

    <div class="sidebar-spacer"></div>

    <a class="sidebar-logout" href="{{ url_for('logout') }}">Cerrar sesion</a>
  </aside>

  <main class="dashboard-main">

    <section class="topbar minimal-topbar">
      <div>
        <div class="page-kicker">Resumen</div>
        <h1 class="page-title">MUSCLE<span class="gain">GAIN</span> / <span class="user">{{ username }}</span></h1>
        <p class="page-subtitle">Resumen de hoy.</p>
      </div>

      <div class="top-actions">
        <a class="dash-btn primary" href="{{ url_for('register_session') }}">Registrar sesion</a>
        <a class="dash-btn secondary" href="{{ url_for('routines') }}">Rutinas</a>
        <button class="notes-btn" id="notesBtn" type="button">Notas</button>
      </div>
    </section>

    <section class="stats-grid minimal-stats kpi-strip">
      <div class="stat-card">
        <span class="stat-label">Racha</span>
        <strong class="stat-value">{{ stats.streak }}</strong>
        <span class="stat-hint">Dias seguidos</span>
      </div>

      <div class="stat-card">
        <span class="stat-label">Entrenos (7 dias)</span>
        <strong class="stat-value">{{ stats.sessions_7d }}</strong>
        <span class="stat-hint">Meta semanal</span>
      </div>

      <div class="stat-card">
        <span class="stat-label">Ultima sesion</span>
        <strong class="stat-value">{{ stats.last_label }}</strong>
        <span class="stat-hint">Registro reciente</span>
      </div>
    </section>

    <section class="panel quick-panel">
      <div class="section-title">Acciones rapidas</div>
      <div class="quick-grid">
        <button class="quick-card" type="button" data-title="Continuar entrenamiento" data-body="Registra tu sesion actual. Agrega sets, peso, reps y notas." data-link="{{ url_for('register_session') }}">
          <div class="quick-title">Continuar entrenamiento</div>
          <div class="quick-sub">Registro rapido.</div>
        </button>
        <button class="quick-card" type="button" data-title="Crear rutina" data-body="Define dias y ejercicios. Todo editable." data-link="{{ url_for('routines') }}">
          <div class="quick-title">Crear rutina</div>
          <div class="quick-sub">Plan semanal.</div>
        </button>
        <button class="quick-card" type="button" data-title="Registrar serie" data-body="Agrega series sueltas a una sesion." data-link="{{ url_for('register_session') }}">
          <div class="quick-title">Registrar serie</div>
          <div class="quick-sub">Detalle limpio.</div>
        </button>
        <button class="quick-card" type="button" data-title="Ver progreso" data-body="Historial, PR estimado y volumen por ejercicio." data-link="{{ url_for('progress') }}">
          <div class="quick-title">Ver progreso</div>
          <div class="quick-sub">Datos claros.</div>
        </button>
        <button class="quick-card" type="button" data-title="Ejercicios por musculo" data-body="Explora ejercicios por zona." data-link="{{ url_for('muscle_map') }}">
          <div class="quick-title">Ejercicios por musculo</div>
          <div class="quick-sub">Mapa corporal.</div>
        </button>
      </div>
    </section>

    <section class="today-panel minimal-today exec-panel">
      <div class="today-head">
        <div>
          <h2>Plan de hoy</h2>
          <p class="today-sub">Sugerencia segun tus datos.</p>
        </div>
        <div class="today-badge">{{ focus.chip }}</div>
      </div>

      <div class="today-grid minimal-grid exec-grid">
        <div class="today-box">
          <span class="mini-label">Accion del dia</span>
          <div class="big">{{ focus.action_title }}</div>
          <div class="mini">{{ focus.action_sub }}</div>
        </div>

        <div class="today-box">
          <span class="mini-label">Siguiente paso</span>
          <div class="big good">{{ focus.next_step }}</div>
          <div class="mini">{{ focus.next_step_sub }}</div>
        </div>
      </div>

      <div class="today-cta">
        <a class="dash-btn primary" href="{{ url_for('register_session') }}">Registrar sesion</a>
        <a class="dash-btn secondary" href="{{ url_for('progress') }}">Ver progreso</a>
        <a class="dash-btn secondary" href="{{ url_for('muscle_map') }}">Músculos</a>
      </div>

      <div class="minimal-lower exec-lower">
        <div class="activity-list compact">
          <div class="section-title">Actividad reciente</div>
          <div class="activity-grid compact">
            {% if activity and activity|length > 0 %}
              {% for a in activity[:3] %}
                <div class="note-line activity-line compact">
                  <div>
                    <strong class="activity-date">{{ a.date }}</strong>
                    <div class="activity-meta">
                      {{ a.duration_min }} min{% if a.note %} · {{ a.note }}{% endif %}
                    </div>
                  </div>
                </div>
              {% endfor %}
            {% else %}
              <div class="empty-state steps">
                <div class="empty-title">Sin sesiones</div>
                <div class="empty-steps">
                  <div>1. Registra tu primera sesion.</div>
                  <div>2. Agrega al menos 3 ejercicios.</div>
                  <div>3. Revisa tu progreso semanal.</div>
                </div>
                <a class="btn btn-primary" href="{{ url_for('register_session') }}">Registrar sesion</a>
              </div>
            {% endif %}
          </div>
        </div>

        <div class="notes-rotator minimal-notes" id="notesRotator" data-notes='{{ notes|tojson }}'>
          <div class="notes-rotator-head">
            <h3>Notas</h3>
            <div class="notes-rotator-sub">Ideas y recordatorios.</div>
          </div>

          <div class="note-box compact">
            <div class="note-text" id="noteText"></div>
            <div class="note-controls minimal-controls">
              <button class="note-btn" id="notePrev" type="button">Anterior</button>
              <button class="note-btn" id="noteNext" type="button">Siguiente</button>
              <button class="note-btn ghost" id="noteCopy" type="button">Copiar</button>
              <button class="note-btn ghost" id="noteSave" type="button">Guardar</button>
              <div class="note-dots" id="noteDots"></div>
            </div>
          </div>
        </div>
      </div>

    </section>

    <p class="dash-footer">MUSCLE<span class="gain">GAIN</span> · Registro de entrenamiento.</p>

  </main>
</div>

<div class="notes-modal" id="notesModal" aria-hidden="true">
  <div class="notes-card" role="dialog" aria-modal="true">
    <div class="notes-top">
      <h3>Notas</h3>
      <button class="notes-close" id="notesClose" type="button">x</button>
    </div>

    <div class="notes-list" id="notesList">
      {% for n in notes %}
        <div class="note-line">• {{ n }}</div>
      {% endfor %}
    </div>
  </div>
</div>

<div class="toast" id="toast">Listo.</div>

<div class="quick-modal" id="quickModal" aria-hidden="true">
  <div class="quick-card-modal" role="dialog" aria-modal="true">
    <div class="quick-modal-head">
      <h3 id="quickModalTitle">Accion</h3>
      <button class="quick-modal-close" id="quickModalClose" type="button">x</button>
    </div>
    <div class="quick-modal-body" id="quickModalBody"></div>
    <div class="quick-modal-actions">
      <a class="btn btn-primary" id="quickModalGo" href="#">Ir ahora</a>
      <button class="btn btn-secondary" id="quickModalCancel" type="button">Cerrar</button>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
